<?xml version="1.0" encoding="utf-8"?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ShopperMaui.ViewModels"
             x:Class="ShopperMaui.Controls.ProductControl"
             x:DataType="vm:ProductViewModel">
    <Border Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource PrimaryLight}}" 
            StrokeThickness="1" 
            StrokeShape="RoundRectangle 8" 
            Padding="8" 
            Margin="0,4" 
            BackgroundColor="{AppThemeBinding Light={StaticResource CardBackground}, Dark={StaticResource CardBackgroundDark}}">
        <VerticalStackLayout Spacing="8">
            <!-- Product Info Row -->
            <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto"
                  ColumnSpacing="8"
                  VerticalOptions="Center">
                <CheckBox Grid.Column="0"
                          IsChecked="{Binding IsPurchased}"
                          VerticalOptions="Center"/>

                <Label Grid.Column="1"
                       Text="{Binding Name}"
                       FontAttributes="Bold"
                       FontSize="14"
                       VerticalOptions="Center"
                       LineBreakMode="TailTruncation">
                    <Label.Triggers>
                        <DataTrigger TargetType="Label"
                                Binding="{Binding IsPurchased}"
                                Value="True">
                            <Setter Property="TextDecorations"
                                    Value="Strikethrough"/>
                            <Setter Property="TextColor"
                                    Value="{StaticResource TextMuted}"/>
                        </DataTrigger>
                    </Label.Triggers>
                </Label>

                <HorizontalStackLayout Grid.Column="2"
                                       Spacing="0"
                                       VerticalOptions="Center">
                    <Button Text="-"
                            Command="{Binding DecreaseQuantityCommand}"
                            Style="{StaticResource GhostButton}"
                            WidthRequest="32"
                            HeightRequest="32"
                            Padding="0"/>
                    <Label Text="{Binding Quantity}"
                           WidthRequest="30"
                           HorizontalTextAlignment="Center"
                           VerticalTextAlignment="Center"/>
                    <Button Text="+"
                            Command="{Binding IncreaseQuantityCommand}"
                            Style="{StaticResource GhostButton}"
                            WidthRequest="32"
                            HeightRequest="32"
                            Padding="0"/>
                </HorizontalStackLayout>

                <Label Grid.Column="3"
                        Text="{Binding Unit}"
                        TextColor="{StaticResource TextSecondary}"
                        FontSize="12"
                        VerticalOptions="Center"
                        WidthRequest="40"/>

                <Button Grid.Column="4"
                        Text="x"
                        Command="{Binding DeleteProductCommand}"
                        Style="{StaticResource GhostButton}"
                        TextColor="{StaticResource Danger}"
                        WidthRequest="32"
                        HeightRequest="32"
                        Padding="0"/>
            </Grid>

            <!-- Store Selection Row -->
            <Grid ColumnDefinitions="*,Auto"
                  ColumnSpacing="12"
                  VerticalOptions="Center">
                <Picker Grid.Column="0"
                        ItemsSource="{Binding AvailableStores}"
                        SelectedItem="{Binding StoreName, Mode=TwoWay}"
                        Title="Wybierz sklep"
                        FontSize="12"
                        TextColor="{StaticResource TextPrimaryDark}"/>

                <HorizontalStackLayout Grid.Column="1" Spacing="8" VerticalOptions="Center">
                     <Label Text="Opcjonalny"
                           FontSize="10"
                           TextColor="{StaticResource TextMuted}"
                           VerticalOptions="Center"
                           IsVisible="{Binding IsOptional}"/>
                </HorizontalStackLayout>
            </Grid>
        </VerticalStackLayout>

        <Border.Triggers>
            <DataTrigger TargetType="Border"
                    Binding="{Binding IsOptional}"
                    Value="True">
                <Setter Property="StrokeDashArray"
                        Value="2,2"/>
            </DataTrigger>
            <DataTrigger TargetType="Border"
                    Binding="{Binding IsPurchased}"
                    Value="True">
                <Setter Property="Opacity"
                        Value="0.5"/>
            </DataTrigger>
        </Border.Triggers>
    </Border>
</ContentView>
