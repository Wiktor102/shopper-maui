<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ShopperMaui.ViewModels"
             x:Class="ShopperMaui.Views.ManageDataPage"
             x:Name="ManageDataPageRoot"
             x:DataType="vm:ManageDataViewModel"
             Title="ZarzÄ…dzanie danymi">

    <Grid RowDefinitions="Auto,*">
        <!-- Tab Selector -->
        <Border Grid.Row="0" 
                Margin="16,16,16,0"
                Padding="4"
                StrokeShape="RoundRectangle 12"
                BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray800}}">
            <Grid ColumnDefinitions="*,*" ColumnSpacing="4">
                <Button Text="ðŸ“ Kategorie"
                        Command="{Binding Source={x:Reference ManageDataPageRoot}, Path=SelectCategoriesTabCommand}"
                        Style="{StaticResource TabButton}"
                        BackgroundColor="{Binding SelectedTabIndex, Converter={StaticResource TabBackgroundConverter}, ConverterParameter=0}" />
                <Button Grid.Column="1"
                        Text="ðŸª Sklepy"
                        Command="{Binding Source={x:Reference ManageDataPageRoot}, Path=SelectStoresTabCommand}"
                        Style="{StaticResource TabButton}"
                        BackgroundColor="{Binding SelectedTabIndex, Converter={StaticResource TabBackgroundConverter}, ConverterParameter=1}" />
            </Grid>
        </Border>

        <!-- Categories Tab Content -->
        <Grid Grid.Row="1" 
              Padding="16"
              IsVisible="{Binding SelectedTabIndex, Converter={StaticResource TabVisibilityConverter}, ConverterParameter=0}">
            
            <!-- Categories List -->
            <CollectionView ItemsSource="{Binding Categories}"
                            SelectionMode="None"
                            IsVisible="{Binding HasCategories}">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="12" />
                </CollectionView.ItemsLayout>
                <CollectionView.Header>
                    <Button Text="+ Dodaj kategoriÄ™"
                            Command="{Binding AddCategoryCommand}"
                            Style="{StaticResource OutlineButton}"
                            HorizontalOptions="Fill"
                            Margin="0,0,0,16"/>
                </CollectionView.Header>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="vm:CategoryViewModel">
                        <Border Style="{StaticResource CardBorder}">
                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                <VerticalStackLayout Spacing="4" VerticalOptions="Center">
                                    <Entry Text="{Binding Name}"
                                           Placeholder="Nazwa kategorii"
                                           FontAttributes="Bold"
                                           FontSize="16" />
                                    <Label Text="{Binding ProductSummary}"
                                           FontSize="12"
                                           TextColor="{StaticResource TextSecondary}" />
                                </VerticalStackLayout>
                                <Button Grid.Column="1"
                                        Text="ðŸ—‘ï¸"
                                        Command="{Binding DeleteCategoryCommand}"
                                        Style="{StaticResource IconDangerButton}"
                                        WidthRequest="44"
                                        HeightRequest="44"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Empty Categories State -->
            <VerticalStackLayout IsVisible="{Binding HasCategories, Converter={StaticResource InverseBooleanConverter}}"
                                 VerticalOptions="Center"
                                 HorizontalOptions="Fill"
                                 Spacing="16">
                <Border Style="{StaticResource CardBorder}"
                        HorizontalOptions="Fill">
                    <VerticalStackLayout Spacing="12"
                                         HorizontalOptions="Center">
                        <Label Text="ðŸ“" 
                               FontSize="48" 
                               HorizontalTextAlignment="Center" />
                        <Label Text="Brak kategorii"
                               FontSize="18"
                               FontAttributes="Bold"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Dodaj pierwszÄ… kategoriÄ™, aby zaczÄ…Ä‡ budowaÄ‡ listÄ™ zakupÃ³w."
                               Opacity="0.75"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>
                <Button Text="+ Dodaj kategoriÄ™"
                        Command="{Binding AddCategoryCommand}"
                        HorizontalOptions="Fill"/>
            </VerticalStackLayout>
        </Grid>

        <!-- Stores Tab Content -->
        <Grid Grid.Row="1" 
              Padding="16"
              IsVisible="{Binding SelectedTabIndex, Converter={StaticResource TabVisibilityConverter}, ConverterParameter=1}">
            
            <!-- Stores List -->
            <CollectionView ItemsSource="{Binding Stores}"
                            SelectionMode="None"
                            IsVisible="{Binding HasStores}">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="12" />
                </CollectionView.ItemsLayout>
                <CollectionView.Header>
                    <Button Text="+ Dodaj sklep"
                            Command="{Binding AddStoreCommand}"
                            Style="{StaticResource OutlineButton}"
                            HorizontalOptions="Fill"
                            Margin="0,0,0,16"/>
                </CollectionView.Header>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="x:String">
                        <Border Style="{StaticResource CardBorder}">
                            <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8" VerticalOptions="Center">
                                <Label Text="{Binding .}"
                                       FontAttributes="Bold"
                                       FontSize="16"
                                       VerticalOptions="Center" />
                                <Button Grid.Column="1"
                                        Text="âœï¸"
                                        Command="{Binding Source={x:Reference ManageDataPageRoot}, Path=BindingContext.RenameStoreCommand}"
                                        CommandParameter="{Binding .}"
                                        Style="{StaticResource IconSecondaryButton}"
                                        WidthRequest="44"
                                        HeightRequest="44"/>
                                <Button Grid.Column="2"
                                        Text="ðŸ—‘ï¸"
                                        Command="{Binding Source={x:Reference ManageDataPageRoot}, Path=BindingContext.DeleteStoreCommand}"
                                        CommandParameter="{Binding .}"
                                        Style="{StaticResource IconDangerButton}"
                                        WidthRequest="44"
                                        HeightRequest="44"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Empty Stores State -->
            <VerticalStackLayout IsVisible="{Binding HasStores, Converter={StaticResource InverseBooleanConverter}}"
                                 VerticalOptions="Center"
                                 HorizontalOptions="Fill"
                                 Spacing="16">
                <Border Style="{StaticResource CardBorder}"
                        HorizontalOptions="Fill">
                    <VerticalStackLayout Spacing="12"
                                         HorizontalOptions="Center">
                        <Label Text="ðŸª" 
                               FontSize="48" 
                               HorizontalTextAlignment="Center" />
                        <Label Text="Brak sklepÃ³w"
                               FontSize="18"
                               FontAttributes="Bold"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Dodaj pierwszy sklep, aby szybciej porzÄ…dkowaÄ‡ produkty."
                               Opacity="0.75"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>
                <Button Text="+ Dodaj sklep"
                        Command="{Binding AddStoreCommand}"
                        HorizontalOptions="Fill"/>
            </VerticalStackLayout>
        </Grid>
    </Grid>
</ContentPage>
